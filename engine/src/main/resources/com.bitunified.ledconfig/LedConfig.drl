/*
 * Copyright 2016 BitUnified B.V. and/or its affiliates.
 *
 */

package com.bitunified.ledconfig;
 
import com.bitunified.ledconfig.domain.product.PCB.LedStrip;

import com.bitunified.ledconfig.domain.Dimension;
import com.bitunified.ledconfig.composedproduct.ComposedProduct;
import com.bitunified.ledconfig.domain.message.Message
import com.bitunified.ledconfig.domain.product.cover.types.ResinClear;
import com.bitunified.ledconfig.domain.product.cover.types.Resin;
import com.bitunified.ledconfig.domain.product.PCB.types.RGBLedStrip;
import com.bitunified.ledconfig.domain.product.PCB.types.DecoLedStrip;
import com.bitunified.ledconfig.domain.product.PCB.LedStrip;
import com.bitunified.ledconfig.domain.product.cable.Cable;
import com.bitunified.ledconfig.domain.Property
import com.bitunified.ledconfig.domain.product.accessoires.Clip
import com.bitunified.ledconfig.parts.Part;



global java.util.List<Message> messages
 
rule "Led strip section modulo"
    dialect "mvel"
    when
        
        cp : LedStrip( props:properies )
        exists(
        Property(name==LedStrip.SECTION_WIDTH,(value!=null) && ((value % cp.dimension.width)!=0))
         from props)
    then

    messages.add(new Message("Ledstrip lengte moet een veelvoud zijn van sectielengte."));

end

rule "Totale lengte minimaal"
    when
        ledstrip:LedStrip(props:properies,afmetingen:dimension)
        composedproduct:ComposedProduct(dimension.width<(afmetingen.width+10+5))

    then
        messages.add(new Message("Totale lengte is groter dan ledstrip lengte inclusief marges."));

end

rule "Totale lengte is groter dan maximale ledstrip lengte"
    when
        LedStrip(maxDim:maxDimension)
        LedStrip(maxDimension.width!=null)
        ComposedProduct(productDimension:dimension)
        ComposedProduct(productDimension.width<maxDim.width)

    then
        messages.add(new Message("Totale lengte is groter dan maximale ledstrip lengte."));

end

rule "Kap en gieting"

    when
        Resin()
        DecoLedStrip(COLOR_PROP.value=="ROOD")
    then
        messages.add(new Message("Rood met giethars niet mogelijk" ));

end

rule "Minimale lengte groter dan section lengte"
    when
        LedStrip(dimension.width<SECTION.value);
    then
        messages.add(new Message("Lengte ledstrip kan niet kleiner zijn dan sectie lengte."));
end

rule "Kabeltype moet overeenkomen met PCB type"
    when
        DecoLedStrip();
        Cable(TYPE.value!="2-aderig");
    then
        messages.add(new Message("Let op: kabeltype past niet bij PCB."));
    end

rule "Aantal clips is evenredig aan lengte"
no-loop false
    when
        composedproduct:ComposedProduct();

        count : Number(intValue<=composedproduct.dimension.width/50)
          from accumulate( i : Part( product.class==Clip.class )from composedproduct.products, count( i ) )

    then
        modify(composedproduct){
         getProducts().add(new Part(new Clip()))

        }
        System.out.println("Clip toegevoegd");
    end